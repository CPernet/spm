function spm_surf_node = spm_cfg_spm_surf
% SPM Configuration file
% automatically generated by the MATLABBATCH utility function GENCODE
%_______________________________________________________________________
% Copyright (C) 2008 Wellcome Trust Centre for Neuroimaging

% $Id: spm_cfg_spm_surf.m 1295 2008-04-02 14:31:24Z volkmar $

rev = '$Rev: 1295 $';
% ---------------------------------------------------------------------
% data Grey+white matter image
% ---------------------------------------------------------------------
data         = cfg_files;
data.tag     = 'data';
data.name    = 'Grey+white matter image';
data.help    = {'Images to create rendering/surface from (grey and white matter segments).'};
data.filter = 'image';
data.ufilter = '.*';
data.num     = [1 Inf];
% ---------------------------------------------------------------------
% mode Output
% ---------------------------------------------------------------------
mode         = cfg_menu;
mode.tag     = 'mode';
mode.name    = 'Output';
mode.val{1} = double(3);
mode.help    = {''};
mode.labels = {
               'Save Rendering'
               'Save Extracted Surface'
               'Save Rendering and Surface'
               'Save Surface as OBJ format'
}';
mode.values{1} = double(1);
mode.values{2} = double(2);
mode.values{3} = double(3);
mode.values{4} = double(4);
% ---------------------------------------------------------------------
% thresh Surface isovalue(s)
% ---------------------------------------------------------------------
thresh         = cfg_entry;
thresh.tag     = 'thresh';
thresh.name    = 'Surface isovalue(s)';
thresh.val{1} = double(0.5);
thresh.help    = {'Enter one or more values at which isosurfaces through the input images will be computed.'};
thresh.strtype = 'e';
thresh.num     = [1 Inf];
% ---------------------------------------------------------------------
% spm_surf Create Rendering/Surface
% ---------------------------------------------------------------------
spm_surf_node         = cfg_exbranch;
spm_surf_node.tag     = 'spm_surf';
spm_surf_node.name    = 'Create Rendering/Surface';
spm_surf_node.val     = { data mode thresh};
spm_surf_node.help    = {''};
spm_surf_node.prog = @spm_surf;
spm_surf_node.vout = @vout_surf;
% ---------------------------------------------------------------------
%
% ---------------------------------------------------------------------
function dep = vout_surf(job)
% fail silently, if job.mode or job.thresh can not be evaluated
try
    cdep = 1;
    if any(job.mode==[1 3]),
        dep(cdep)            = cfg_dep;
        dep(cdep).sname      = 'Render .mat File';
        dep(cdep).src_output = substruct('.','rendfile');
        dep(cdep).tgt_spec   = cfg_findspec({{'class','cfg_files','strtype','e'}});
        cdep = cdep+1;
    end;

    if any(job.mode==[2 3 4]),
        for k=1:numel(job.thresh)
            if any(job.mode==[2 3]),
                dep(cdep)            = cfg_dep;
                dep(cdep).sname      = sprintf('Surf .mat File (thr=%.02f)', ...
                                               job.thresh(k));
                dep(cdep).src_output = substruct('.','surffile', '()',{k});
                dep(cdep).tgt_spec   = cfg_findspec({{'class','cfg_files','strtype','e'}});
                cdep = cdep+1;
            end;
            if any(job.mode==[4]),
                dep(cdep)            = cfg_dep;
                dep(cdep).sname      = sprintf('Surf .obj File (thr=%.02f)', ...
                                               job.thresh(k));
                dep(cdep).src_output = substruct('.','objfile', '()',{k});
                dep(cdep).tgt_spec   = cfg_findspec({{'class','cfg_files','strtype','e'}});
                cdep = cdep+1;
            end;
        end;
    end;
catch
    % something failed, no dependencies
    dep = [];
end;
